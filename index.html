<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music</title>

  <style>
   body{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  background: #050a06;
  color: #a6ffb6;
  padding: 24px;
}

.player{
  max-width: 520px;
  border: 1px solid #2cff66;
  padding: 14px;
  background: rgba(0,0,0,0.6);
  box-shadow: 0 0 18px rgba(44,255,102,0.25);
  position: relative;
}

.player::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(166,255,182,0.08),
      rgba(166,255,182,0.08) 1px,
      rgba(0,0,0,0) 3px,
      rgba(0,0,0,0) 4px
    );
  mix-blend-mode: screen;
}

#title{
  margin: 0 0 10px;
  letter-spacing: 0.5px;
  text-shadow: 0 0 8px rgba(44,255,102,0.5);
}

#audio{
  width: 100%;
  filter: hue-rotate(90deg) saturate(1.3); /* tints default controls slightly */
  margin-bottom: 10px;
}

#playlist{
  list-style: none;
  padding: 0;
  margin: 0;
  border-top: 1px dashed rgba(44,255,102,0.5);
  max-height: 240px;
  overflow: auto;
}

#playlist li{
  padding: 6px 0;
  cursor: pointer;
  opacity: 0.9;
}

#playlist li:hover{
  opacity: 1;
  text-decoration: underline;
}

#playlist li.active{
  color: #2cff66;
  font-weight: 700;
}

  </style>
</head>

<body>
  <h1>ðŸŽ§ Music</h1>

  <div class="player">
  <h3 id="title">Loadingâ€¦</h3>
  <audio id="audio" controls preload="metadata"></audio>
  <ul id="playlist"></ul>
  </div>


  <script>
    const OWNER = "dkacan98";
    const REPO = "dkacan98.github.io";
    const BRANCH = "main";
    const AUDIO_PATH = "audio";
    const ALLOWED = [".mp3", ".m4a", ".ogg", ".wav"];

    const audio = document.getElementById("audio");
    const titleEl = document.getElementById("title");
    const playlistEl = document.getElementById("playlist");

    let tracks = [];
    let current = 0;

    function niceTitle(filename) {
      return filename
        .replace(/\.[^/.]+$/, "")
        .replace(/[_-]+/g, " ")
        .trim();
    }

    function loadTrack(i, autoplay = false) {
      current = i;
      audio.src = tracks[i].src;
      titleEl.textContent = tracks[i].title;

      [...playlistEl.children].forEach((li, idx) => {
        li.classList.toggle("active", idx === i);
      });

      if (autoplay) audio.play().catch(() => {});
    }

    function buildPlaylist() {
      playlistEl.innerHTML = "";
      tracks.forEach((t, i) => {
        const li = document.createElement("li");
        li.textContent = t.title;
        li.addEventListener("click", () => loadTrack(i, true));
        playlistEl.appendChild(li);
      });
      if (tracks.length) loadTrack(0, false);
    }

    audio.addEventListener("ended", () => {
      loadTrack((current + 1) % tracks.length, true);
    });

    async function fetchTracks() {
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${AUDIO_PATH}?ref=${BRANCH}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Could not read audio folder");

      const items = await res.json();

      tracks = items
        .filter(x => x.type === "file")
        .map(x => x.name)
        .filter(name => ALLOWED.some(ext => name.toLowerCase().endsWith(ext)))
        .sort((a, b) => a.localeCompare(b))
        .map(name => ({
          title: niceTitle(name),
          src: `${AUDIO_PATH}/${encodeURIComponent(name)}`
        }));

      if (!tracks.length) {
        titleEl.textContent = "No audio files found";
        return;
      }

      buildPlaylist();
    }

    fetchTracks().catch(err => {
      console.error(err);
      titleEl.textContent = "Failed to load playlist";
    });
  </script>
</body>
</html>
